# MTSCDNet - è¯­ä¹‰å˜åŒ–æ£€æµ‹ç½‘ç»œ

åŸºäºå¤šä»»åŠ¡å­¦ä¹ çš„åŒæ—¶ç›¸é¥æ„Ÿå›¾åƒè¯­ä¹‰å˜åŒ–æ£€æµ‹ç½‘ç»œçš„å®Œæ•´PyTorchå®ç°ã€‚

## ğŸ“„ è®ºæ–‡

**MTSCD-Net: A network based on multi-task learning for semantic change detection of bitemporal remote sensing images**

å‘è¡¨äº *International Journal of Applied Earth Observation and Geoinformation* (2023)

## ğŸŒŸ ä¸»è¦ç‰¹æ€§

- âœ… **å®Œæ•´å®ç°**: ä¸¥æ ¼æŒ‰ç…§è®ºæ–‡æè¿°å®ç°æ‰€æœ‰æ¨¡å—
- âœ… **Swin Transformer**: ä½¿ç”¨Swin Transformerä½œä¸ºç¼–ç å™¨éª¨å¹²ç½‘ç»œ
- âœ… **å¤šä»»åŠ¡å­¦ä¹ **: åŒæ—¶å¤„ç†è¯­ä¹‰åˆ†å‰²å’Œå˜åŒ–æ£€æµ‹ä¸¤ä¸ªå­ä»»åŠ¡
- âœ… **å¤šå°ºåº¦ç‰¹å¾èšåˆ**: èåˆå¤šä¸ªå°ºåº¦çš„ç‰¹å¾ä¿¡æ¯
- âœ… **å˜åŒ–ä¿¡æ¯æå–**: ä½¿ç”¨ä¸¤çº§å·®å¼‚ç‰¹å¾å¢å¼ºå˜åŒ–æ£€æµ‹èƒ½åŠ›
- âœ… **ç©ºé—´ç‰¹å¾å¢å¼º**: åˆ©ç”¨å˜åŒ–ä¿¡æ¯ä¸ºè¯­ä¹‰åˆ†å‰²æä¾›ç©ºé—´å…ˆéªŒ
- âœ… **å®Œæ•´è¯„ä¼°æŒ‡æ ‡**: OA, mIoU, SeK, Fscd, Score

## ğŸ“ é¡¹ç›®ç»“æ„

```
SCDNet/
â”œâ”€â”€ models/                      # æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ mtscdnet.py             # MTSCDNetä¸»æ¨¡å‹
â”‚   â”œâ”€â”€ swin_transformer.py     # Swin Transformerç¼–ç å™¨
â”‚   â””â”€â”€ modules.py              # å„ä¸ªåŠŸèƒ½æ¨¡å—
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ dataset.py              # æ•°æ®é›†åŠ è½½å™¨
â”‚   â”œâ”€â”€ losses.py               # æŸå¤±å‡½æ•°
â”‚   â””â”€â”€ metrics.py              # è¯„ä¼°æŒ‡æ ‡
â”œâ”€â”€ data/                        # æ•°æ®ç›®å½•(éœ€è‡ªè¡Œä¸‹è½½)
â”‚   â””â”€â”€ SECOND/
â”‚       â”œâ”€â”€ train/
â”‚       â”œâ”€â”€ val/
â”‚       â””â”€â”€ test/
â”œâ”€â”€ checkpoints/                 # æ¨¡å‹æ£€æŸ¥ç‚¹
â”œâ”€â”€ logs/                        # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ results/                     # æµ‹è¯•ç»“æœ
â”œâ”€â”€ train.py                     # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ test.py                      # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ config.py                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…
â””â”€â”€ README_CN.md                 # è¯´æ˜æ–‡æ¡£

```

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### ä¾èµ–å®‰è£…

```bash
# å®‰è£…PyTorch (æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬é€‰æ‹©)
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# å®‰è£…å…¶ä»–ä¾èµ–
pip install -r requirements.txt
```

### ç¯å¢ƒè¦æ±‚

- Python >= 3.7
- PyTorch >= 1.10.0
- CUDA >= 11.0 (æ¨è)
- GPUå†…å­˜ >= 12GB (è®­ç»ƒæ—¶)

## ğŸ“Š æ•°æ®é›†å‡†å¤‡

### SECONDæ•°æ®é›†

æœ¬é¡¹ç›®ä½¿ç”¨SECONDæ•°æ®é›†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ã€‚

**æ•°æ®é›†ç»“æ„:**

```
SECOND/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ im1/              # æ—¶é—´1çš„RGBå›¾åƒ
â”‚   â”œâ”€â”€ im2/              # æ—¶é—´2çš„RGBå›¾åƒ
â”‚   â”œâ”€â”€ label1_rgb/       # æ—¶é—´1çš„è¯­ä¹‰æ ‡ç­¾(RGBæ ¼å¼)
â”‚   â””â”€â”€ label2_rgb/       # æ—¶é—´2çš„è¯­ä¹‰æ ‡ç­¾(RGBæ ¼å¼)
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ im1/
â”‚   â”œâ”€â”€ im2/
â”‚   â”œâ”€â”€ label1_rgb/
â”‚   â””â”€â”€ label2_rgb/
â””â”€â”€ test/
    â”œâ”€â”€ im1/
    â”œâ”€â”€ im2/
    â”œâ”€â”€ label1_rgb/
    â””â”€â”€ label2_rgb/
```

**ç±»åˆ«å®šä¹‰:**

| ç±»åˆ«ID | ç±»åˆ«åç§° | RGBé¢œè‰² |
|--------|----------|---------|
| 0 | Unchanged (æœªå˜åŒ–) | (255, 255, 255) ç™½è‰² |
| 1 | Ground (åœ°é¢) | (128, 128, 128) ç°è‰² |
| 2 | Low-veg (ä½æ¤è¢«) | (0, 128, 0) æ·±ç»¿è‰² |
| 3 | Building (å»ºç­‘ç‰©) | (128, 0, 0) æ·±çº¢è‰² |
| 4 | Tree (æ ‘æœ¨) | (0, 255, 0) äº®ç»¿è‰² |
| 5 | Playground (æ“åœº) | (255, 0, 0) çº¢è‰² |
| 6 | Water (æ°´ä½“) | (0, 0, 255) è“è‰² |

## ğŸš€ è®­ç»ƒ

### åŸºæœ¬è®­ç»ƒ

```bash
python train.py \
    --data_root ./data/SECOND \
    --epochs 100 \
    --batch_size 6 \
    --lr 0.00015 \
    --num_workers 4
```

### ä»æ£€æŸ¥ç‚¹æ¢å¤è®­ç»ƒ

```bash
python train.py \
    --data_root ./data/SECOND \
    --resume ./checkpoints/checkpoint_epoch_50.pth
```

### ä¸»è¦è®­ç»ƒå‚æ•°

- `--data_root`: æ•°æ®é›†æ ¹ç›®å½•
- `--epochs`: è®­ç»ƒè½®æ•° (é»˜è®¤: 100)
- `--batch_size`: æ‰¹æ¬¡å¤§å° (é»˜è®¤: 6)
- `--lr`: åˆå§‹å­¦ä¹ ç‡ (é»˜è®¤: 0.00015)
- `--warmup_epochs`: Warm-upè½®æ•° (é»˜è®¤: 20)
- `--alpha_task`: BCDå­ä»»åŠ¡æƒé‡ (é»˜è®¤: 1.0)
- `--beta_task`: SSå­ä»»åŠ¡æƒé‡ (é»˜è®¤: 1.0)
- `--save_freq`: ä¿å­˜æ¨¡å‹é¢‘ç‡ (é»˜è®¤: æ¯10ä¸ªepoch)
- `--eval_freq`: è¯„ä¼°é¢‘ç‡ (é»˜è®¤: æ¯1ä¸ªepoch)

## ğŸ§ª æµ‹è¯•

### åŸºæœ¬æµ‹è¯•

```bash
python test.py \
    --data_root ./data/SECOND \
    --split test \
    --checkpoint ./checkpoints/best_model.pth \
    --save_results
```

### ä¿å­˜å¯è§†åŒ–ç»“æœ

```bash
python test.py \
    --data_root ./data/SECOND \
    --split test \
    --checkpoint ./checkpoints/best_model.pth \
    --save_results \
    --output_dir ./results
```

### ä¸»è¦æµ‹è¯•å‚æ•°

- `--data_root`: æ•°æ®é›†æ ¹ç›®å½•
- `--split`: æµ‹è¯•é›†åˆ’åˆ† (train/val/test)
- `--checkpoint`: æ¨¡å‹æ£€æŸ¥ç‚¹è·¯å¾„
- `--threshold`: å˜åŒ–æ£€æµ‹é˜ˆå€¼ (é»˜è®¤: 0.5)
- `--save_results`: æ˜¯å¦ä¿å­˜é¢„æµ‹ç»“æœ
- `--output_dir`: ç»“æœä¿å­˜ç›®å½•

## ğŸ“ˆ è¯„ä¼°æŒ‡æ ‡

æœ¬é¡¹ç›®å®ç°äº†è®ºæ–‡ä¸­çš„æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡:

### è¯­ä¹‰å˜åŒ–æ£€æµ‹æŒ‡æ ‡

- **OA (Overall Accuracy)**: æ€»ä½“ç²¾åº¦
- **mIoU (Mean IoU)**: å¹³å‡äº¤å¹¶æ¯”
- **SeK (Separated Kappa)**: åˆ†ç¦»Kappaç³»æ•°
- **Fscd**: è¯­ä¹‰å˜åŒ–æ£€æµ‹çš„Fåˆ†æ•°
- **Score**: ç»¼åˆè¯„åˆ† = 0.3 Ã— mIoU + 0.7 Ã— SeK

### äºŒå…ƒå˜åŒ–æ£€æµ‹æŒ‡æ ‡

- **Precision**: ç²¾ç¡®ç‡
- **Recall**: å¬å›ç‡
- **F1**: F1åˆ†æ•°
- **IoU**: äº¤å¹¶æ¯”

## ğŸ—ï¸ æ¨¡å‹æ¶æ„

### æ•´ä½“æ¶æ„

```
åŒæ—¶ç›¸å›¾åƒ (T1, T2)
    â†“
Siamese Swin Transformerç¼–ç å™¨ (æƒé‡å…±äº«)
    â†“
å¤šå°ºåº¦ç‰¹å¾èšåˆæ¨¡å—
    â†“
å˜åŒ–ä¿¡æ¯æå–æ¨¡å—
    â†“
ç©ºé—´ç‰¹å¾å¢å¼ºæ¨¡å—
    â†“
åŒåˆ†æ”¯è§£ç å™¨
    â”œâ”€â†’ è¯­ä¹‰åˆ†å‰²ç»“æœ (T1, T2)
    â””â”€â†’ å˜åŒ–æ£€æµ‹ç»“æœ
```

### å…³é”®æ¨¡å—

1. **Siameseè¯­ä¹‰æ„ŸçŸ¥ç¼–ç å™¨**
   - åŸºäºSwin Transformer
   - é…ç½®: depths=[2, 2, 18, 2]
   - æå–å››ä¸ªå°ºåº¦çš„ç‰¹å¾

2. **å¤šå°ºåº¦ç‰¹å¾èšåˆæ¨¡å—**
   - è‡ªä¸‹è€Œä¸Šèåˆå¤šå°ºåº¦ç‰¹å¾
   - è¾“å‡º: 600é€šé“çš„èåˆç‰¹å¾

3. **å˜åŒ–ä¿¡æ¯æå–æ¨¡å—**
   - ä¸¤çº§å·®å¼‚ç‰¹å¾
   - ç©ºé—´æ³¨æ„åŠ›å’Œé€šé“æ³¨æ„åŠ›
   - ASPPæ¨¡å—å¢å¼ºæ„Ÿå—é‡

4. **ç©ºé—´ç‰¹å¾å¢å¼ºæ¨¡å—**
   - åˆ©ç”¨å˜åŒ–ä¿¡æ¯ç”Ÿæˆç©ºé—´æ³¨æ„åŠ›å›¾
   - ä¸ºè¯­ä¹‰åˆ†å‰²æä¾›ä½ç½®å…ˆéªŒ

## ğŸ“Š å®éªŒç»“æœ

æ ¹æ®è®ºæ–‡,åœ¨SECONDæ•°æ®é›†ä¸Šçš„ç»“æœ:

| æ–¹æ³• | OA (%) | mIoU (%) | SeK (%) | Fscd (%) | Score (%) |
|------|--------|----------|---------|----------|-----------|
| HRSCD.str1 | 38.92 | 27.25 | 4.09 | - | 11.04 |
| HRSCD.str3 | 81.99 | 63.57 | 8.89 | - | 25.30 |
| HRSCD.str4 | 84.44 | 69.44 | 15.97 | - | 32.01 |
| HBSCD | 86.51 | 70.86 | 18.09 | - | 33.92 |
| Bi-SRNet | 87.22 | 71.37 | 19.10 | - | 34.78 |
| **MTSCDNet (è®ºæ–‡)** | **87.04** | **71.68** | **20.57** | **-** | **35.90** |

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

å¯ä»¥ä¿®æ”¹ `config.py` æ–‡ä»¶æ¥è‡ªå®šä¹‰é…ç½®:

```python
from config import Config

# åˆ›å»ºè‡ªå®šä¹‰é…ç½®
config = Config()
config.BATCH_SIZE = 8
config.LEARNING_RATE = 0.0002
config.EPOCHS = 150
```

## ğŸ“ æŸå¤±å‡½æ•°

### æ€»æŸå¤±

```
L_total = Î± Ã— L_c + Î² Ã— L_s
```

å…¶ä¸­:
- `L_c`: å˜åŒ–æ£€æµ‹å­ä»»åŠ¡æŸå¤± = BCE + Tversky
- `L_s`: è¯­ä¹‰åˆ†å‰²å­ä»»åŠ¡æŸå¤± = äº¤å‰ç†µ
- `Î±`, `Î²`: å­ä»»åŠ¡æƒé‡ (é»˜è®¤éƒ½ä¸º1.0)

### TverskyæŸå¤±å‚æ•°

- `Î±21 = 0.3`: å‡é˜´æ€§æƒé‡
- `Î±22 = 0.7`: å‡é˜³æ€§æƒé‡

## âš™ï¸ å­¦ä¹ ç‡ç­–ç•¥

ä½¿ç”¨Warm-up + Polyç­–ç•¥:

1. **Warm-upé˜¶æ®µ** (å‰20ä¸ªepoch):
   ```
   lr = lr_base Ã— (epoch / warmup_epochs)
   ```

2. **Polyé˜¶æ®µ** (ä¹‹å):
   ```
   lr = lr_base Ã— (1 - epoch / total_epochs)^power
   ```
   å…¶ä¸­ `power = 0.9`

## ğŸ¯ æ•°æ®å¢å¼º

åœ¨çº¿æ•°æ®å¢å¼º,æ¦‚ç‡ä¸º0.4,åŒ…æ‹¬:

- éšæœºæ°´å¹³ç¿»è½¬
- éšæœºå‚ç›´ç¿»è½¬
- éšæœºæ—‹è½¬ (90Â°, 180Â°, 270Â°)
- é¢œè‰²æŠ–åŠ¨ (äº®åº¦ã€å¯¹æ¯”åº¦)

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **å†…å­˜ä¸è¶³**: å‡å°batch_sizeæˆ–ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯
2. **è®­ç»ƒä¸ç¨³å®š**: å¢åŠ warm-upè½®æ•°
3. **è¿‡æ‹Ÿåˆ**: å¢åŠ æ•°æ®å¢å¼ºæˆ–ä½¿ç”¨æ›´å¤§çš„æƒé‡è¡°å‡
4. **æ”¶æ•›æ…¢**: è°ƒæ•´å­¦ä¹ ç‡æˆ–ä½¿ç”¨é¢„è®­ç»ƒæƒé‡

## ğŸ“š å¼•ç”¨

å¦‚æœæ‚¨ä½¿ç”¨æœ¬ä»£ç ,è¯·å¼•ç”¨åŸå§‹è®ºæ–‡:

```bibtex
@article{cui2023mtscd,
  title={MTSCD-Net: A network based on multi-task learning for semantic change detection of bitemporal remote sensing images},
  author={Cui, Fengzhi and Jiang, Jie},
  journal={International Journal of Applied Earth Observation and Geoinformation},
  volume={118},
  pages={103294},
  year={2023},
  publisher={Elsevier}
}
```

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿æIssueæˆ–PRã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢åŸè®ºæ–‡ä½œè€…æä¾›çš„è¯¦ç»†æ–¹æ³•æè¿°
- æ„Ÿè°¢SECONDæ•°æ®é›†çš„è´¡çŒ®è€…
- æ„Ÿè°¢Swin Transformerçš„ä½œè€…

---

**æ³¨æ„**: æœ¬å®ç°ä¸¥æ ¼éµå¾ªè®ºæ–‡æè¿°,æ‰€æœ‰æ¨¡å—ã€å‚æ•°å’Œè®­ç»ƒç­–ç•¥éƒ½ä¸è®ºæ–‡ä¿æŒä¸€è‡´ã€‚
